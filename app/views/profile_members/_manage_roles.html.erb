<% form_tag :action => 'save_associations' do %>
  <% @roles.each do |role|%>
    <%= content_tag('p', content_tag('b', role.name.pluralize+':'), :style => 'margin-top: 30px; margin-bottom: 0px;') %>
    <%= text_field_tag('q_'+role.key, nil, :id => 'search_'+role.key) %>
    <%= hidden_field_tag(:last_admin, true) if from == 'last_admin'%>
  <% end %>

  <% button_bar(:style => 'margin-top: 30px;') do %>
    <%= submit_button('save', _('Save'))%>
    <%= button('cancel', _('Cancel'), {:controller => 'profile_editor'})%>
  <% end %>
<% end %>

<%= javascript_include_tag '/plugins/bsc/jquery_tokeninput/src/jquery.tokeninput.js' %>
<% stylesheet('/plugins/bsc/jquery_tokeninput/styles/token-input.css') %>


<% @roles.each do |role| %>
  <% search_url = url_for(:action => 'search_user', :role => role.id, :profile => profile.identifier) %>
  <script type="text/javascript">
    jQuery(<%= ('#search_' + role.key).to_json %>)
    .tokenInput("<%= search_url %>", {
      prePopulate: <%= profile.members_by_role_to_json(role) %>,
      hintText: <%= _('Type in a search term for users').to_json %>,
      noResultsText: <%= _('No results').to_json %>,
      searchingText: <%= _('Searching...').to_json %>,
      searchDelay: 500,
      backspaceDeleteItem: false,
      preventDuplicates: true,
      queryParam: <%= ('q_'+role.key).to_json %>
    })
    .focus();

    jQuery("#token-input-search-enterprises")
    .live("keydown", function(event){
      if(event.keyCode == "13") return false;
    });
  </script>
<% end %>

